{% extends 'videos/base.html' %}

{% block title %}탐지 작업 목록{% endblock %}

<<<<<<< Updated upstream
{% block content %}
<<<<<<< Updated upstream
<div class="row mb-4">
    <div class="col-md-12">
        <div class="d-flex justify-content-between align-items-center">
            <h2><i class="bi bi-search"></i> 탐지 작업 목록</h2>
=======

=======
{% block breadcrumb %}
>>>>>>> Stashed changes
<div class="row">
    <div class="col-md-12">
        <div class="breadcrumb-container">
            <nav aria-label="breadcrumb">
                <ol class="custom-breadcrumb">
<<<<<<< Updated upstream
                    <li class="custom-breadcrumb-item">
                        <a href="{% url 'media_list' %}">
                            <i class="bi bi-folder2-open me-1"></i> 미디어 목록
                        </a>
                    </li>
                    <li class="custom-breadcrumb-item active">
                        <a href="{% url 'vision_engine:detection_list' %}">
=======
                    <li class="custom-breadcrumb-item active">
                        <a href="#">
>>>>>>> Stashed changes
                            <i class="bi bi-search me-1"></i> 탐지 작업
                        </a>
                    </li>
                </ol>
            </nav>
<<<<<<< Updated upstream
>>>>>>> Stashed changes
        </div>
    </div>
</div>

=======
        </div>
    </div>
</div>
{% endblock breadcrumb %}

{% block content %}
>>>>>>> Stashed changes
<!-- 필터 -->
<div class="row mb-3">
    <div class="col-md-12">
        <div class="card border-0 shadow-sm">
            <div class="card-body">
<<<<<<< Updated upstream
<<<<<<< Updated upstream
                <form method="get" class="row g-3">
                    <div class="col-md-3">
                        <label class="form-label">상태</label>
=======
                <form method="get" class="row g-3 justify-content-end">
                    <div class="col-md-3">
                        <!-- <label class="form-label">상태</label> -->
>>>>>>> Stashed changes
=======
                <form method="get" class="row g-3 justify-content-end">
                    <div class="col-md-3">
                        <!-- <label class="form-label">상태</label> -->
>>>>>>> Stashed changes
                        <select name="status" class="form-select">
                            <option value="">전체</option>
                            <option value="ready" {% if request.GET.status == 'ready' %}selected{% endif %}>대기</option>
                            <option value="processing" {% if request.GET.status == 'processing' %}selected{% endif %}>처리 중</option>
                            <option value="completed" {% if request.GET.status == 'completed' %}selected{% endif %}>완료</option>
                            <option value="failed" {% if request.GET.status == 'failed' %}selected{% endif %}>실패</option>
                        </select>
                    </div>
<<<<<<< Updated upstream
<<<<<<< Updated upstream
                    <div class="col-md-3 d-flex align-items-end">
                        <button type="submit" class="btn btn-primary">
                            <i class="bi bi-funnel"></i> 필터
                        </button>
                        <!-- <a href="{% url 'vision_engine:detection_list' %}" class="btn btn-outline-secondary ms-2">
                            <i class="bi bi-x"></i> 초기화
                        </a> -->
=======
=======
>>>>>>> Stashed changes
                    <div class="col-md-auto d-flex align-items-end">
                        <button type="submit" class="btn btn-primary">
                            <i class="bi bi-funnel"></i> 필터
                        </button>
<<<<<<< Updated upstream
>>>>>>> Stashed changes
=======
>>>>>>> Stashed changes
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<!-- 탐지 목록 -->
<div class="row">
    <div class="col-md-12">
        {% if detections %}
        <div class="card border-0 shadow-sm">
            <div class="card-body p-0">
                <div class="table-responsive">
                    <table class="table table-hover mb-0">
                        <thead class="table-light">
                            <tr>
                                <th>ID</th>
                                <th>제목</th>
                                <th>모델</th>
                                <th>미디어</th>
                                <th>상태</th>
                                <th>진행률</th>
                                <th>탐지 수</th>
                                <th>생성일</th>
                                <th>작업</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for detection in detections %}
                            <tr>
                                <td>{{ detection.id }}</td>
                                <td>
                                    <strong>{{ detection.title }}</strong>
                                    {% if detection.description %}
                                    <br><small class="text-muted">{{ detection.description|truncatewords:10 }}</small>
                                    {% endif %}
                                </td>
                                <td>
                                    <span class="badge bg-info">{{ detection.get_model_name }}</span>
                                </td>
                                <td>
                                    {% if detection.analysis.video %}
                                        {{ detection.analysis.video.title|truncatewords:5 }}
                                    {% elif detection.analysis.image %}
                                        {{ detection.analysis.image.title|truncatewords:5 }}
                                    {% else %}
                                        알 수 없음
                                    {% endif %}
                                </td>
                                <td>
                                    {% if detection.status == 'ready' %}
                                    <span class="badge bg-secondary">대기</span>
                                    {% elif detection.status == 'processing' %}
                                    <span class="badge bg-warning">처리 중</span>
                                    {% elif detection.status == 'completed' %}
                                    <span class="badge bg-success">완료</span>
                                    {% elif detection.status == 'failed' %}
                                    <span class="badge bg-danger">실패</span>
                                    {% endif %}
                                </td>
                                <td>
                                    <div class="progress" style="min-width: 80px;">
                                        <div class="progress-bar" 
                                             style="width: {{ detection.progress }}%">
                                            {{ detection.progress }}%
                                        </div>
                                    </div>
                                </td>
                                <td>
                                    {% if detection.total_detections > 0 %}
                                    <span class="badge bg-primary">{{ detection.total_detections }}</span>
                                    {% else %}
                                    <span class="text-muted">-</span>
                                    {% endif %}
                                </td>
                                <td>
                                    <small>{{ detection.created_at|date:"Y-m-d H:i" }}</small>
                                </td>
                                <td>
                                    <div class="btn-group btn-group-sm">
                                        {% if detection.status == 'completed' %}
                                        <a href="{% url 'vision_engine:detection_result' detection.id %}" 
                                           class="btn btn-outline-primary" 
                                           title="결과 보기">
                                            <i class="bi bi-eye"></i>
                                        </a>
                                        {% elif detection.status == 'processing' %}
                                        <a href="{% url 'vision_engine:detection_progress' detection.id %}" 
                                           class="btn btn-outline-warning" 
                                           title="진행 상황">
                                            <i class="bi bi-hourglass-split"></i>
                                        </a>
                                        {% elif detection.status == 'ready' %}
                                        <a href="{% url 'vision_engine:execute_detection' detection.id %}" 
                                           class="btn btn-outline-success" 
                                           title="실행">
                                            <i class="bi bi-play"></i>
                                        </a>
                                        {% endif %}
                                        
                                        <a href="{% url 'vision_engine:detection_delete' detection.id %}" 
                                           class="btn btn-outline-danger" 
                                           title="삭제">
                                            <i class="bi bi-trash"></i>
                                        </a>
                                    </div>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
        {% else %}
        <div class="card border-0 shadow-sm">
            <div class="card-body text-center py-5">
                <i class="bi bi-inbox display-1 text-muted"></i>
                <h5 class="mt-3 text-muted">탐지 작업이 없습니다</h5>
                <p class="text-muted">분석이 완료된 미디어에서 객체 탐지를 시작하세요.</p>
<<<<<<< Updated upstream
<<<<<<< Updated upstream
                <a href="{% url 'video_list' %}" class="btn btn-primary">
=======
                <a href="{% url 'media_list' %}" class="btn btn-primary">
>>>>>>> Stashed changes
=======
                <a href="{% url 'media_list' %}" class="btn btn-primary">
>>>>>>> Stashed changes
                    <i class="bi bi-film"></i> 미디어 목록으로
                </a>
            </div>
        </div>
        {% endif %}
    </div>
</div>
{% endblock %}
<<<<<<< Updated upstream
<<<<<<< Updated upstream
=======

>>>>>>> Stashed changes
=======

>>>>>>> Stashed changes
